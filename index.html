<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa con Leaflet</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #map {
            width: 100%;
            height: 400px;
        }
        .controls {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <input type="text" id="locationInput" placeholder="Direcci\u00f3n o coordenadas (lat,lng)" size="40">
        <select id="mapType">
            <option value="mapa">Mapa</option>
            <option value="satelite">Sat\u00e9lite</option>
        </select>
        <button onclick="geocode()">Buscar</button>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        const osmLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; OpenStreetMap contributors'
        });
        const satelliteLayer = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            maxZoom: 19,
            attribution: 'Tiles &copy; Esri'
        });

        const map = L.map('map', { layers: [osmLayer] }).setView([-34.6037, -58.3816], 8);
        let marker;

        document.getElementById('mapType').addEventListener('change', function() {
            if (this.value === 'satelite') {
                map.addLayer(satelliteLayer);
                map.removeLayer(osmLayer);
            } else {
                map.addLayer(osmLayer);
                map.removeLayer(satelliteLayer);
            }
        });

        function geocode() {
            const input = document.getElementById('locationInput').value.trim();
            if (!input) return;

            const coordMatch = input.match(/^(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)$/);
            if (coordMatch) {
                const lat = parseFloat(coordMatch[1]);
                const lng = parseFloat(coordMatch[2]);
                setMarker(lat, lng);
            } else {
                fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(input)}`)
                    .then(r => r.json())
                    .then(results => {
                        if (results && results[0]) {
                            const lat = parseFloat(results[0].lat);
                            const lng = parseFloat(results[0].lon);
                            setMarker(lat, lng);
                        } else {
                            alert('No se pudo encontrar la ubicaci\u00f3n');
                        }
                    })
                    .catch(() => alert('Error al buscar la direcci\u00f3n'));
            }
        }

        function setMarker(lat, lng) {
            map.setView([lat, lng], 13);
            if (marker) {
                marker.setLatLng([lat, lng]);
            } else {
                marker = L.marker([lat, lng]).addTo(map);
            }
        }
    </script>
</body>
</html>